<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Census 2020 - Change Map</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script
    type="text/javascript"
    src="/js/lib/dummy.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/result-light.css">

      <script type="text/javascript" src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js"></script>
      <link rel="stylesheet" type="text/css" href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css">

  <style id="compiled-css" type="text/css">
      
      body {
        margin: 0;
        padding: 0;
      }
      h2,
      h3 {
        margin: 10px;
        font-size: 1.2em;
      }
      h3 {
        font-size: 1em;
      }
      p {
        font-size: 0.85em;
        margin: 10px;
        text-align: left;
      }
      .map-overlay {
        position: absolute;
        bottom: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.8);
        margin-right: 20px;
        font-family: Arial, sans-serif;
        overflow: auto;
        border-radius: 3px;
      }
      #map {
        position: absolute;
        top: 47px;
        bottom: 0;
        width: 100%;
      }
      #features {
        top: 0;
        height: 220px;
        margin-top: 110px;
        width: 250px;
      }
      #layerpicker {
        top: 0;
        left: 0;
        margin-top: 5px;
        width: 250px;
      }
      #legend {
          padding: 10px;
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          line-height: 18px;
          margin-bottom: 40px;
          width: 200px;
      }
      .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
      }
    /* EOS */
  </style>

  <script id="insert"></script>


</head>
<body>
    <!-- Navbar -->
    <div class="w3-top">
    <div class="w3-bar w3-black w3-card">
        <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
        <a href="/" class="w3-bar-item w3-button w3-padding-large">HOME</a>
        <a href="#contact" class="w3-bar-item w3-button w3-padding-large w3-hide-small">CONTACT</a>
        <div class="w3-dropdown-hover w3-hide-small">
        <button class="w3-padding-large w3-button" title="More"> CHANGE GEOGRAPHY <i class="fa fa-caret-down"></i></button>     
        <div class="w3-dropdown-content w3-bar-block w3-card-4">
            <option a href="/censusblocks" class="w3-bar-item w3-button">Census Blocks - 6 county Bay Area</a>
            <option disabled = "disabled" a href="#" class="w3-bar-item w3-button">U.S. Counties - Not Yet Available</a>
        </div>
        </div>
    </div>
    </div>

    <!-- Navbar on small screens (remove the onclick attribute if you want the navbar to always show on top of the content when clicking on the links) -->
    <div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
    <a href="/" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">HOME</a>
    <div class="w3-dropdown-content w3-bar-block w3-card-4"> 
        <option a href="/censusblocks" class="w3-bar-item w3-button">Census Blocks - 6 county Bay Area</a>
        <option disabled = "disabled" a href="#" class="w3-bar-item w3-button">U.S. Counties - Not Yet Available</a>
     </div>
    </div>
  <!-- Load the `mapbox-gl-geocoder` plugin. -->
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
<div id="map"></div>
<div class="map-overlay" id="features">
  <div id="pd">
    <h2>Census 2020 Rate of Change</h2>
    <p>Select a neighborhood to see population, demographics, housing units and household growth or decline from 2010 to 2020.</p>
  </div>
  <select id='layerpicker'>
    <option disabled = "disabled" style="color:gray" >2020 People Data</option>
    <option value="PopulationGrowth">Total Population</option>
    <option value="LatinoPopulationGrowth">Latino</option>
    <option value="WhitePopulationGrowth">White</option>
    <option value="BlackPopulationGrowth">Black</option>
    <option value="AsianPopulationGrowth">Asian</option>
    <option value="MultiracePopulationGrowth">Multi-Racial</option>
    <option value="OtherPopulationGrowth">Other Race</option>
    <option value="NativePopulationGrowth">Native American</option>
    <option value="PacificPopulationGrowth">Pacific Islander</option>
    <option value="HousingGrowth">Housing Units</option>
    <option value="VacantHomesGrowth">Vacant Units</option>
    <option disabled = "disabled" >2020 Household Data</option>
    <option value="AllH">Total Homeowner Households</option>
    <option value="AllR">Total Rental Households</option>
    <option value="LH">Latino Homeowners</option>
    <option value="LR">Latino Renters</option>
    <option value="WH">White Homeowners</option>
    <option value="WR">White Renters</option>
    <option value="BH">Black Homeowners</option>
    <option value="BR">Black Renters</option>
    <option value="AH">Asian Homeowners</option>
    <option value="AR">Asian Renters</option>
    <option value="NH">Native Am. Homeowners</option>
    <option value="NR">Native Am. Renters</option>
    <option value="PH">Pacific Isl. Homeowners</option>
    <option value="PR">Pacific Isl. Renters</option>
    <option value="OH">Other Race Homeowners</option>
    <option value="OR">Other Race Renters</option>
    <option value="MH">Multi-Race Homeowners</option>
    <option value="MR">Multi-Race Renters</option>   
  </select>
</div>
<div class="map-overlay" id="legend">
    <div style="font-size: 14px;">
      Severity of Change
    </div>
    <div style="background: linear-gradient(90deg, #7e0101, white, #01650c); height: 10px; width: 100%; margin: 5px 0;"></div>
    <div style="display: flex; justify-content: space-between;font-size: 12px;">
        <span>-1000</span>
        <span>0</span>
        <span>+1000</span>
    </div>
  </div>
    <script type="text/javascript">//<![CDATA[
      // define access token
      mapboxgl.accessToken = 'pk.eyJ1IjoiaWRvdGhldGhpbmtpbmciLCJhIjoiY2xsYTZjeWk4MGh1dDNwbWFyeTE4N24wYiJ9.bYsPWcw9_3A3tg6Se98o9g'; 
      let selectedLayer = 'PopulationGrowth';
      //create map
      var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/idothethinking/ckshtdrsj7si217mw9ua1e42v', // map style URL from Mapbox Studio
	center:[-122.264,37.812], //center over Oakland
        zoom: 11.0
      });
      //Geocoder
      map.addControl(
        new MapboxGeocoder({
          accessToken: mapboxgl.accessToken,
          mapboxgl: mapboxgl
        })
      );
      //Navigation
    	var nav = new mapboxgl.NavigationControl();
    	map.addControl(nav, 'top-left'); 
      // map layers -- we iterate through these to turn them all off
      let mapLayers = ['WhitePopulationGrowth', 'LatinoPopulationGrowth', 'BlackPopulationGrowth', 'AsianPopulationGrowth', 'OtherPopulationGrowth', 'MultiracePopulationGrowth',"NativePopulationGrowth","PacificPopulationGrowth", 'HousingGrowth', 'VacantHomesGrowth',"PopulationGrowth", "AllH", "AllR", "LH","LR",
        "WH", "WR", "BH", "BR", "AH", "AR", "NH", "NR", "PH", "PR", "OH", "OR", "MH", "MR"]
      // layer listener
      const selectElement = document.querySelector('#layerpicker');

      selectElement.addEventListener('change', (event) => {
        console.log(event.target.value)
        selectedLayer = event.target.value
        mapLayers.forEach(l => map.setLayoutProperty(l, "visibility", "none"))
        map.setLayoutProperty(event.target.value, "visibility", "visible")
      });

      // wait for map to load before adjusting it
      map.on('load', function() {
        // make a pointer cursor
        map.getCanvas().style.cursor = 'default';

        // set map bounds to the continental US

        // make a pointer cursor
        map.getCanvas().style.cursor = 'default';

        // Add layer to display highlighted tract
        const highlightLayer = 'highlight-layer';
        map.addLayer({
          id: highlightLayer,
          type: 'line',
          source: "composite",
          "source-layer": "CA2020CensusNetChange-3cu4y1",
          paint: {
            'line-color': '#000000',
            'line-width': 5,
            'line-opacity' : 1
          },
          filter: ['==','TRACTCE',''],
        });
				// Dict dec
				let lookuprace = {"WhitePopulationGrowth" : "White",
        "BlackPopulationGrowth" : "Black",
        "LatinoPopulationGrowth" : "Latino",
        "AsianPopulationGrowth" : "Asian",
        "OtherPopulationGrowth" : "Other",
        "NativePopulationGrowth" : "Native American",
        "PacificPopulationGrowth" : "Pacific Islander",
        "MultiracePopulationGrowth" : "Multi-Race",
        "HousingGrowth" : "Homes",
        "VacantHomesGrowth": "Vacant",
        "PopulationGrowth" : "Population",
        "AllH" : "Homeowners", "AllR": "Renters", "LH": "LatinoHomeowners","LR":"LatinoRenters",
        "WH":"WhiteHomeowners", "WR": "WhiteRenters", "BH":"BlackHomeowners", "BR":"BlackRenters", "AH":"AsianHomeowners", "AR":"AsianRenters", "NH":"Native AmericanHomeowners", "NR":"Native AmericanRenters", "PH":"Pacific IslanderHomeowners", "PR":"Pacific IslanderRenters", "OH":"OtherHomeowners", "OR":"OtherRenters", "MR" : "Multi-RaceRenters", "MH" : "Multi-RaceHomeowners"
        }
       	let lookupracenet = {"WhitePopulationGrowth" : "WhiteNet",
        "BlackPopulationGrowth" : "BlackNet",
        "LatinoPopulationGrowth" : "LatinoNet",
        "AsianPopulationGrowth" : "AsianNet",
        "OtherPopulationGrowth" : "OtherNet",
        "MultiracePopulationGrowth" : "Multi-RaceNet",
        "NativePopulationGrowth" : "Native AmericanNet",
        "PacificPopulationGrowth" : "Pacific IslanderNet",
        "HousingGrowth" : "HomesNet",
        "VacantHomesGrowth": "VacantNet",
        "PopulationGrowth" : "PopulationNet",
        "AllH" : "Net Homeowners", "AllR": "Net Renters", "LH": "Net Latino Homeowners","LR":"Net Latino Renters",
        "WH":"Net White Homeowners", "WR": "Net White Renters", "BH":"Net Black Homeowners", "BR":"Net Black Renters", "AH":"Net Asian Homeowners", "AR":"Net Asian Renters", "NH":"Net Native American Homeowners", "NR":"Net Native American Renters", "PH":"Net Pacific Islander Homeowners", "PR":"Net Pacific Islander Renters", "OH":"Net Other Homeowners", "OR":"Net Other Renters", "MR" : "Net Multi-Race Renters", "MH" : "Net Multi-Race Homeowners"
        }
        let lookupracenetper = {"WhitePopulationGrowth" : "WhiteNetPer",
        "BlackPopulationGrowth" : "BlackNetPer",
        "LatinoPopulationGrowth" : "LatinoNetPer",
        "AsianPopulationGrowth" : "AsianNetPer",
        "OtherPopulationGrowth" : "OtherNetPer",
        "MultiracePopulationGrowth" : "Multi-RaceNetPer",
        "NativePopulationGrowth" : "Native AmericanNetPer",
        "PacificPopulationGrowth" : "Pacific IslanderNetPer",
        "HousingGrowth" : "HomesNetPer",
        "VacantHomesGrowth": "VacantNetPer",
        "PopulationGrowth": "PopulationNetPer",
        "AllH" : "Net Homeowners Per", "AllR": "Net Renters Per", "LH": "Net Latino Homeowners Per","LR":"Net Latino Renters Per",
        "WH":"Net White Homeowners Per", "WR": "Net White Renters Per", "BH":"Net Black Homeowners Per", "BR":"Net Black Renters Per", "AH":"Net Asian Homeowners Per", "AR":"Net Asian Renters Per", "NH":"Net Native American Homeowners Per", "NR":"Net Native American Renters Per", "PH":"Net Pacific Islander Homeowners Per", "PR":"Net Pacific Islander Renters Per", "OH":"Net Other Homeowners Per", "OR":"Net Other Renters Per", "MR" : "Net Multi-Race Renters Per", "MH" : "Net Multi-Race Homeowners Per"
        }
        let lookname = {"WhitePopulationGrowth" : "White pop. (2020): ",
        "BlackPopulationGrowth" : "Black pop. (2020): ",
        "LatinoPopulationGrowth" : "Latino pop. (2020): ",
        "AsianPopulationGrowth" : "Asian pop. (2020): ",
        "OtherPopulationGrowth" : "Other pop. (2020): ",
        "MultiracePopulationGrowth" : "Multi-Race pop. (2020): ",
        "NativePopulationGrowth" : "Native American pop. (2020): ",
        "PacificPopulationGrowth" : "Pacific Islander pop. (2020): ",
        "HousingGrowth" : "Total Housing Units (2020): ",
        "VacantHomesGrowth": "Vacant Housing Units (2020): ",
        "PopulationGrowth" : "Total Population (2020): ",
        "AllH" : "Owner Households (2020): ", "AllR": "Renter Households (2020): ", "LH": "Latino Homeowners (2020): ","LR" : "Latino Leaseholders (2020): ",
        "WH" : "White Homeowners (2020): ", "WR" : "White Leaseholders (2020): ", "BH" : "Black Homeowners (2020): ", "BR" : "Black Leaseholders (2020): ", "AH" : "Asian Homeowners (2020): ", "AR" : "Asian Leaseholders (2020): ", "NH" : "Native American Homeowners (2020): ", "NR" : "Native American Leaseholders (2020): " , "PH" : "Pacific Islander Homeowners (2020): " , "PR": "Pacific Islander Leaseholders (2020): ", "OH" : "Other Homeowners (2020): ", "OR": "Other Leaseholders (2020): ", "MH" : "Multi-Race Homeowners (2020): " , "MR": "Multi-Race Leaseholders (2020): "
        }
         let lookname10 = {
        "WhitePopulationGrowth" : "White pop. (2010): ",
        "BlackPopulationGrowth" : "Black pop. (2010): ",
        "LatinoPopulationGrowth" : "Latino pop. (2010): ",
        "AsianPopulationGrowth" : "Asian pop. (2010): ",
        "OtherPopulationGrowth" : "Other pop. (2010): ",
        "MultiracePopulationGrowth" : "Multi-Race pop. (2010): ",
        "NativePopulationGrowth" : "Native American pop. (2010): ",
        "PacificPopulationGrowth" : "Pacific Islander pop. (2010): ",
        "HousingGrowth" : "Total Housing Units (2010): ",
        "VacantHomesGrowth": "Vacant Housing Units (2010): ",
        "PopulationGrowth" : "Total Population (2010): ",
        "AllH" : "Owner Households (2010): ", "AllR": "Renter Households (2010): ", "LH": "Latino Homeowners (2010): ","LR" : "Latino Leaseholders (2010): ",
        "WH" : "White Homeowners (2010): ", "WR" : "White Leaseholders (2010): ", "BH" : "Black Homeowners (2010): ", "BR" : "Black Leaseholders (2010): ", "AH" : "Asian Homeowners (2010): ", "AR" : "Asian Leaseholders (2010): ", "NH" : "Native American Homeowners (2010): ", "NR" : "Native American Leaseholders (2010): " , "PH" : "Pacific Islander Homeowners (2010): " , "PR": "Pacific Islander Leaseholders (2010): ", "OH" : "Other Homeowners (2010): ", "OR": "Other Leaseholders (2010): ", "MH" : "Multi-Race Homeowners (2010): " , "MR": "Multi-Race Leaseholders (2010): "
        }

        // change info window on hover
        map.on('mousemove', function(e) {
          var tracts = map.queryRenderedFeatures(e.point, {
            layers: [selectedLayer]
          });
          map.setFilter(highlightLayer, ['==', 'TRACTCE', tracts[0].properties.TRACTCE]);
					if (tracts.length > 0){
              var decade10 = tracts[0]['properties'][lookuprace[selectedLayer]] - tracts[0]['properties'][lookupracenet[selectedLayer]]
                    plus = ''
		    if (tracts[0]['properties'][lookupracenet[selectedLayer]]> 0){
			     plus = '+'
		    }
		    else{
			     plus = ''
		    }
        data10 = tracts[0]['properties'][lookuprace[selectedLayer]]- tracts[0]['properties'][lookupracenet[selectedLayer]] 
	      document.getElementById('pd').innerHTML =
              '<h3><strong>' +
              tracts[0]['properties']['CountyName'] +
              '</strong><br>' +              
              'Census Tract: ' +
              tracts[0]['properties']['TRACTCE'] +
              '</h3><span style="font-size: 1.1em;"><p>' +
              lookname[selectedLayer] + 
              (tracts[0]['properties'][lookuprace[selectedLayer]]).toLocaleString() + '</p><p>' +
              lookname10[selectedLayer] + data10.toLocaleString() +
              '</p><strong><p>Difference since 2010: ' + plus +
              (tracts[0]['properties'][lookupracenet[selectedLayer]]).toLocaleString() +
              ' (' + plus +
              tracts[0]['properties'][lookupracenetper[selectedLayer]] + '%)</p></span></strong>';
          }
        });
      });



  //]]></script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "1cxdy0qr"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>


</body>
</html>

